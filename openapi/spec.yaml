openapi: 3.1.0
info:
  title: Receipts API
  version: 1.0.0

paths:
  /api/health:
    get:
      operationId: Get
      tags: [Health]
      summary: Health check
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string

  # ──────────────────────────────────────────────
  # Accounts
  # ──────────────────────────────────────────────

  /api/accounts/{id}:
    get:
      operationId: GetAccountById
      tags: [Accounts]
      summary: Get an account by ID
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccountResponse"
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateAccount
      tags: [Accounts]
      summary: Update a single account
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateAccountRequest"
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/accounts:
    get:
      operationId: GetAllAccounts
      tags: [Accounts]
      summary: Get all accounts
      security:
        - BearerAuth: []
        - ApiKey: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AccountResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    post:
      operationId: CreateAccount
      tags: [Accounts]
      summary: Create a single account
      security:
        - BearerAuth: []
        - ApiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAccountRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccountResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    delete:
      operationId: DeleteAccounts
      tags: [Accounts]
      summary: Delete accounts
      security:
        - BearerAuth: []
        - ApiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                format: uuid
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/accounts/{id}/restore:
    post:
      operationId: RestoreAccount
      tags: [Accounts]
      summary: Restore a soft-deleted account
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/accounts/batch:
    post:
      operationId: CreateAccounts
      tags: [Accounts]
      summary: Create accounts in batch
      security:
        - BearerAuth: []
        - ApiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/CreateAccountRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AccountResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateAccounts
      tags: [Accounts]
      summary: Update accounts in batch
      security:
        - BearerAuth: []
        - ApiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/UpdateAccountRequest"
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  # ──────────────────────────────────────────────
  # Receipts
  # ──────────────────────────────────────────────

  /api/receipts/{id}:
    get:
      operationId: GetReceiptById
      tags: [Receipts]
      summary: Get a receipt by ID
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReceiptResponse"
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateReceipt
      tags: [Receipts]
      summary: Update a single receipt
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateReceiptRequest"
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/receipts:
    get:
      operationId: GetAllReceipts
      tags: [Receipts]
      summary: Get all receipts
      security:
        - BearerAuth: []
        - ApiKey: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReceiptResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    post:
      operationId: CreateReceipt
      tags: [Receipts]
      summary: Create a single receipt
      security:
        - BearerAuth: []
        - ApiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateReceiptRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReceiptResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    delete:
      operationId: DeleteReceipts
      tags: [Receipts]
      summary: Delete receipts
      security:
        - BearerAuth: []
        - ApiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                format: uuid
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/receipts/{id}/restore:
    post:
      operationId: RestoreReceipt
      tags: [Receipts]
      summary: Restore a soft-deleted receipt
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/receipts/batch:
    post:
      operationId: CreateReceipts
      tags: [Receipts]
      summary: Create receipts in batch
      security:
        - BearerAuth: []
        - ApiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/CreateReceiptRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReceiptResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateReceipts
      tags: [Receipts]
      summary: Update receipts in batch
      security:
        - BearerAuth: []
        - ApiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/UpdateReceiptRequest"
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  # ──────────────────────────────────────────────
  # Receipt Items
  # ──────────────────────────────────────────────

  /api/receipt-items/{id}:
    get:
      operationId: GetReceiptItemById
      tags: [ReceiptItems]
      summary: Get a receipt item by ID
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Receipt item ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReceiptItemResponse"
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    post:
      operationId: CreateReceiptItem
      tags: [ReceiptItems]
      summary: Create a single receipt item
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Receipt ID to create item for
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateReceiptItemRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReceiptItemResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateReceiptItem
      tags: [ReceiptItems]
      summary: Update a single receipt item
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Receipt ID to update item for
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateReceiptItemRequest"
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/receipt-items:
    get:
      operationId: GetAllReceiptItems
      tags: [ReceiptItems]
      summary: Get all receipt items
      security:
        - BearerAuth: []
        - ApiKey: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReceiptItemResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    delete:
      operationId: DeleteReceiptItems
      tags: [ReceiptItems]
      summary: Delete receipt items
      security:
        - BearerAuth: []
        - ApiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                format: uuid
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/receipt-items/{id}/restore:
    post:
      operationId: RestoreReceiptItem
      tags: [ReceiptItems]
      summary: Restore a soft-deleted receipt item
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/receipt-items/by-receipt-id/{receiptId}:
    get:
      operationId: GetReceiptItemsByReceiptId
      tags: [ReceiptItems]
      summary: Get receipt items by receipt ID
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReceiptItemResponse"
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/receipt-items/{id}/batch:
    post:
      operationId: CreateReceiptItems
      tags: [ReceiptItems]
      summary: Create receipt items in batch
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Receipt ID to create items for
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/CreateReceiptItemRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReceiptItemResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateReceiptItems
      tags: [ReceiptItems]
      summary: Update receipt items in batch
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Receipt ID to update items for
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/UpdateReceiptItemRequest"
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  # ──────────────────────────────────────────────
  # Transactions
  # ──────────────────────────────────────────────

  /api/transactions/{id}:
    get:
      operationId: GetTransactionById
      tags: [Transactions]
      summary: Get a transaction by ID
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionResponse"
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/transactions:
    get:
      operationId: GetAllTransactions
      tags: [Transactions]
      summary: Get all transactions
      security:
        - BearerAuth: []
        - ApiKey: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TransactionResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    delete:
      operationId: DeleteTransactions
      tags: [Transactions]
      summary: Delete transactions
      security:
        - BearerAuth: []
        - ApiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                format: uuid
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/transactions/{id}/restore:
    post:
      operationId: RestoreTransaction
      tags: [Transactions]
      summary: Restore a soft-deleted transaction
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/transactions/by-receipt-id/{receiptId}:
    get:
      operationId: GetTransactionsByReceiptId
      tags: [Transactions]
      summary: Get transactions by receipt ID
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TransactionResponse"
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/transactions/{receiptId}/{accountId}:
    post:
      operationId: CreateTransaction
      tags: [Transactions]
      summary: Create a single transaction
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: accountId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTransactionRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateTransaction
      tags: [Transactions]
      summary: Update a single transaction
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: accountId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateTransactionRequest"
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/transactions/{receiptId}/{accountId}/batch:
    post:
      operationId: CreateTransactions
      tags: [Transactions]
      summary: Create transactions in batch
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: accountId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/CreateTransactionRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TransactionResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateTransactions
      tags: [Transactions]
      summary: Update transactions in batch
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: accountId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/UpdateTransactionRequest"
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  # ──────────────────────────────────────────────
  # Aggregates (read-only)
  # ──────────────────────────────────────────────

  /api/receipts-with-items/by-receipt-id/{receiptId}:
    get:
      operationId: GetReceiptWithItemsByReceiptId
      tags: [ReceiptWithItems]
      summary: Get receipt with items by receipt ID
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReceiptWithItemsResponse"
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/transaction-accounts/by-transaction-id/{transactionId}:
    get:
      operationId: GetTransactionAccountByTransactionId
      tags: [TransactionAccount]
      summary: Get transaction account by transaction ID
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: transactionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionAccountResponse"
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/transaction-accounts/by-receipt-id/{receiptId}:
    get:
      operationId: GetTransactionAccountsByReceiptId
      tags: [TransactionAccount]
      summary: Get transaction accounts by receipt ID
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TransactionAccountResponse"
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/trips/by-receipt-id/{receiptId}:
    get:
      operationId: GetTripByReceiptId
      tags: [Trip]
      summary: Get trip by receipt ID
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TripResponse"
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  # ──────────────────────────────────────────────
  # Auth
  # ──────────────────────────────────────────────

  /api/auth/register:
    post:
      operationId: Register
      tags: [Auth]
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
        "400":
          description: Bad Request
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/auth/login:
    post:
      operationId: Login
      tags: [Auth]
      summary: Login with email and password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/auth/refresh:
    post:
      operationId: RefreshToken
      tags: [Auth]
      summary: Refresh access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshTokenRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/auth/logout:
    post:
      operationId: Logout
      tags: [Auth]
      summary: Logout and invalidate refresh token
      security:
        - BearerAuth: []
        - ApiKey: []
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  # ──────────────────────────────────────────────
  # API Keys
  # ──────────────────────────────────────────────

  /api/apikeys:
    get:
      operationId: GetApiKeys
      tags: [ApiKeys]
      summary: Get all API keys for the authenticated user
      security:
        - BearerAuth: []
        - ApiKey: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ApiKeyResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    post:
      operationId: CreateApiKey
      tags: [ApiKeys]
      summary: Create a new API key
      security:
        - BearerAuth: []
        - ApiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateApiKeyRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateApiKeyResponse"
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/apikeys/{id}:
    delete:
      operationId: RevokeApiKey
      tags: [ApiKeys]
      summary: Revoke an API key
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  # ──────────────────────────────────────────────
  # User Roles (admin-only)
  # ──────────────────────────────────────────────

  /api/users/{userId}/roles:
    get:
      operationId: GetUserRoles
      tags: [UserRoles]
      summary: List roles for a user
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserRolesResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/users/{userId}/roles/{role}:
    post:
      operationId: AssignUserRole
      tags: [UserRoles]
      summary: Assign role to user
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
        - name: role
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    delete:
      operationId: RemoveUserRole
      tags: [UserRoles]
      summary: Remove role from user
      security:
        - BearerAuth: []
        - ApiKey: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
        - name: role
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

components:
  schemas:
    # ── Account ──────────────────────────────────

    CreateAccountRequest:
      type: object
      required: [accountCode, name, isActive]
      properties:
        accountCode:
          type: string
        name:
          type: string
        isActive:
          type: boolean

    UpdateAccountRequest:
      type: object
      required: [id, accountCode, name, isActive]
      properties:
        id:
          type: string
          format: uuid
        accountCode:
          type: string
        name:
          type: string
        isActive:
          type: boolean

    AccountResponse:
      type: object
      required: [id, accountCode, name, isActive]
      properties:
        id:
          type: string
          format: uuid
        accountCode:
          type: string
        name:
          type: string
        isActive:
          type: boolean

    # ── Receipt ──────────────────────────────────

    CreateReceiptRequest:
      type: object
      required: [location, date, taxAmount]
      properties:
        description:
          type:
            - string
            - "null"
        location:
          type: string
        date:
          type: string
          format: date
        taxAmount:
          type: number
          format: double

    UpdateReceiptRequest:
      type: object
      required: [id, location, date, taxAmount]
      properties:
        id:
          type: string
          format: uuid
        description:
          type:
            - string
            - "null"
        location:
          type: string
        date:
          type: string
          format: date
        taxAmount:
          type: number
          format: double

    ReceiptResponse:
      type: object
      required: [id, location, date, taxAmount]
      properties:
        id:
          type: string
          format: uuid
        description:
          type:
            - string
            - "null"
        location:
          type: string
        date:
          type: string
          format: date
        taxAmount:
          type: number
          format: double

    # ── Receipt Item ─────────────────────────────

    CreateReceiptItemRequest:
      type: object
      required: [receiptItemCode, description, quantity, unitPrice, category, subcategory]
      properties:
        receiptItemCode:
          type: string
        description:
          type: string
        quantity:
          type: number
          format: double
        unitPrice:
          type: number
          format: double
        category:
          type: string
        subcategory:
          type: string

    UpdateReceiptItemRequest:
      type: object
      required: [id, receiptItemCode, description, quantity, unitPrice, category, subcategory]
      properties:
        id:
          type: string
          format: uuid
        receiptItemCode:
          type: string
        description:
          type: string
        quantity:
          type: number
          format: double
        unitPrice:
          type: number
          format: double
        category:
          type: string
        subcategory:
          type: string

    ReceiptItemResponse:
      type: object
      required: [id, receiptItemCode, description, quantity, unitPrice, category, subcategory]
      properties:
        id:
          type: string
          format: uuid
        receiptItemCode:
          type: string
        description:
          type: string
        quantity:
          type: number
          format: double
        unitPrice:
          type: number
          format: double
        category:
          type: string
        subcategory:
          type: string

    # ── Transaction ──────────────────────────────

    CreateTransactionRequest:
      type: object
      required: [amount, date]
      properties:
        amount:
          type: number
          format: double
        date:
          type: string
          format: date

    UpdateTransactionRequest:
      type: object
      required: [id, amount, date]
      properties:
        id:
          type: string
          format: uuid
        amount:
          type: number
          format: double
        date:
          type: string
          format: date

    TransactionResponse:
      type: object
      required: [id, amount, date]
      properties:
        id:
          type: string
          format: uuid
        amount:
          type: number
          format: double
        date:
          type: string
          format: date

    # ── Aggregates (read-only) ───────────────────

    ReceiptWithItemsResponse:
      type: object
      required: [receipt, items]
      properties:
        receipt:
          $ref: "#/components/schemas/ReceiptResponse"
        items:
          type: array
          items:
            $ref: "#/components/schemas/ReceiptItemResponse"

    TransactionAccountResponse:
      type: object
      required: [transaction, account]
      properties:
        transaction:
          $ref: "#/components/schemas/TransactionResponse"
        account:
          $ref: "#/components/schemas/AccountResponse"

    TripResponse:
      type: object
      required: [receipt, transactions]
      properties:
        receipt:
          $ref: "#/components/schemas/ReceiptWithItemsResponse"
        transactions:
          type: array
          items:
            $ref: "#/components/schemas/TransactionAccountResponse"

    ProblemDetails:
      type: object
      properties:
        type:
          type:
            - string
            - "null"
        title:
          type:
            - string
            - "null"
        status:
          type:
            - integer
            - "null"
          format: int32
        detail:
          type:
            - string
            - "null"
        instance:
          type:
            - string
            - "null"

    # ── Auth ──────────────────────────────────────

    RegisterRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
        password:
          type: string
        firstName:
          type:
            - string
            - "null"
        lastName:
          type:
            - string
            - "null"

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
        password:
          type: string

    TokenResponse:
      type: object
      required: [accessToken, refreshToken, expiresIn]
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        expiresIn:
          type: integer
          format: int32

    RefreshTokenRequest:
      type: object
      required: [refreshToken]
      properties:
        refreshToken:
          type: string

    CreateApiKeyRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        expiresAt:
          type:
            - string
            - "null"
          format: date-time

    ApiKeyResponse:
      type: object
      required: [id, name, createdAt, isRevoked]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        createdAt:
          type: string
          format: date-time
        lastUsedAt:
          type:
            - string
            - "null"
          format: date-time
        expiresAt:
          type:
            - string
            - "null"
          format: date-time
        isRevoked:
          type: boolean

    CreateApiKeyResponse:
      type: object
      required: [id, name, rawKey, createdAt]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        rawKey:
          type: string
        createdAt:
          type: string
          format: date-time
        expiresAt:
          type:
            - string
            - "null"
          format: date-time

    UserRolesResponse:
      type: object
      required: [roles]
      properties:
        roles:
          type: array
          items:
            type: string

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    ApiKey:
      type: apiKey
      in: header
      name: X-API-Key
