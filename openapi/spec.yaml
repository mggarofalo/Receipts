openapi: 3.1.0
info:
  title: Receipts API
  version: 1.0.0

paths:
  /api/health:
    get:
      operationId: Get
      tags: [Health]
      summary: Health check
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string

  # ──────────────────────────────────────────────
  # Accounts
  # ──────────────────────────────────────────────

  /api/accounts/{id}:
    get:
      operationId: GetAccountById
      tags: [Accounts]
      summary: Get an account by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccountResponse"
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateAccount
      tags: [Accounts]
      summary: Update a single account
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateAccountRequest"
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/accounts:
    get:
      operationId: GetAllAccounts
      tags: [Accounts]
      summary: Get all accounts
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AccountResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    post:
      operationId: CreateAccount
      tags: [Accounts]
      summary: Create a single account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAccountRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccountResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    delete:
      operationId: DeleteAccounts
      tags: [Accounts]
      summary: Delete accounts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                format: uuid
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/accounts/batch:
    post:
      operationId: CreateAccounts
      tags: [Accounts]
      summary: Create accounts in batch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/CreateAccountRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AccountResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateAccounts
      tags: [Accounts]
      summary: Update accounts in batch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/UpdateAccountRequest"
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  # ──────────────────────────────────────────────
  # Receipts
  # ──────────────────────────────────────────────

  /api/receipts/{id}:
    get:
      operationId: GetReceiptById
      tags: [Receipts]
      summary: Get a receipt by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReceiptResponse"
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateReceipt
      tags: [Receipts]
      summary: Update a single receipt
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateReceiptRequest"
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/receipts:
    get:
      operationId: GetAllReceipts
      tags: [Receipts]
      summary: Get all receipts
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReceiptResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    post:
      operationId: CreateReceipt
      tags: [Receipts]
      summary: Create a single receipt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateReceiptRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReceiptResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    delete:
      operationId: DeleteReceipts
      tags: [Receipts]
      summary: Delete receipts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                format: uuid
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/receipts/batch:
    post:
      operationId: CreateReceipts
      tags: [Receipts]
      summary: Create receipts in batch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/CreateReceiptRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReceiptResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateReceipts
      tags: [Receipts]
      summary: Update receipts in batch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/UpdateReceiptRequest"
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  # ──────────────────────────────────────────────
  # Receipt Items
  # ──────────────────────────────────────────────

  /api/receipt-items/{id}:
    get:
      operationId: GetReceiptItemById
      tags: [ReceiptItems]
      summary: Get a receipt item by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Receipt item ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReceiptItemResponse"
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    post:
      operationId: CreateReceiptItem
      tags: [ReceiptItems]
      summary: Create a single receipt item
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Receipt ID to create item for
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateReceiptItemRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReceiptItemResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateReceiptItem
      tags: [ReceiptItems]
      summary: Update a single receipt item
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Receipt ID to update item for
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateReceiptItemRequest"
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/receipt-items:
    get:
      operationId: GetAllReceiptItems
      tags: [ReceiptItems]
      summary: Get all receipt items
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReceiptItemResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    delete:
      operationId: DeleteReceiptItems
      tags: [ReceiptItems]
      summary: Delete receipt items
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                format: uuid
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/receipt-items/by-receipt-id/{receiptId}:
    get:
      operationId: GetReceiptItemsByReceiptId
      tags: [ReceiptItems]
      summary: Get receipt items by receipt ID
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReceiptItemResponse"
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/receipt-items/{id}/batch:
    post:
      operationId: CreateReceiptItems
      tags: [ReceiptItems]
      summary: Create receipt items in batch
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Receipt ID to create items for
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/CreateReceiptItemRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReceiptItemResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateReceiptItems
      tags: [ReceiptItems]
      summary: Update receipt items in batch
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Receipt ID to update items for
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/UpdateReceiptItemRequest"
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  # ──────────────────────────────────────────────
  # Transactions
  # ──────────────────────────────────────────────

  /api/transactions/{id}:
    get:
      operationId: GetTransactionById
      tags: [Transactions]
      summary: Get a transaction by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionResponse"
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/transactions:
    get:
      operationId: GetAllTransactions
      tags: [Transactions]
      summary: Get all transactions
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TransactionResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    delete:
      operationId: DeleteTransactions
      tags: [Transactions]
      summary: Delete transactions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                format: uuid
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/transactions/by-receipt-id/{receiptId}:
    get:
      operationId: GetTransactionsByReceiptId
      tags: [Transactions]
      summary: Get transactions by receipt ID
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TransactionResponse"
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/transactions/{receiptId}/{accountId}:
    post:
      operationId: CreateTransaction
      tags: [Transactions]
      summary: Create a single transaction
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: accountId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTransactionRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateTransaction
      tags: [Transactions]
      summary: Update a single transaction
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: accountId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateTransactionRequest"
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/transactions/{receiptId}/{accountId}/batch:
    post:
      operationId: CreateTransactions
      tags: [Transactions]
      summary: Create transactions in batch
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: accountId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/CreateTransactionRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TransactionResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string
    put:
      operationId: UpdateTransactions
      tags: [Transactions]
      summary: Update transactions in batch
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: accountId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/UpdateTransactionRequest"
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  # ──────────────────────────────────────────────
  # Aggregates (read-only)
  # ──────────────────────────────────────────────

  /api/receipts-with-items/by-receipt-id/{receiptId}:
    get:
      operationId: GetReceiptWithItemsByReceiptId
      tags: [ReceiptWithItems]
      summary: Get receipt with items by receipt ID
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReceiptWithItemsResponse"
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/transaction-accounts/by-transaction-id/{transactionId}:
    get:
      operationId: GetTransactionAccountByTransactionId
      tags: [TransactionAccount]
      summary: Get transaction account by transaction ID
      parameters:
        - name: transactionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionAccountResponse"
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/transaction-accounts/by-receipt-id/{receiptId}:
    get:
      operationId: GetTransactionAccountsByReceiptId
      tags: [TransactionAccount]
      summary: Get transaction accounts by receipt ID
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TransactionAccountResponse"
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

  /api/trips/by-receipt-id/{receiptId}:
    get:
      operationId: GetTripByReceiptId
      tags: [Trip]
      summary: Get trip by receipt ID
      parameters:
        - name: receiptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TripResponse"
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: string

components:
  schemas:
    # ── Account ──────────────────────────────────

    CreateAccountRequest:
      type: object
      required: [accountCode, name, isActive]
      properties:
        accountCode:
          type: string
        name:
          type: string
        isActive:
          type: boolean

    UpdateAccountRequest:
      type: object
      required: [id, accountCode, name, isActive]
      properties:
        id:
          type: string
          format: uuid
        accountCode:
          type: string
        name:
          type: string
        isActive:
          type: boolean

    AccountResponse:
      type: object
      required: [id, accountCode, name, isActive]
      properties:
        id:
          type: string
          format: uuid
        accountCode:
          type: string
        name:
          type: string
        isActive:
          type: boolean

    # ── Receipt ──────────────────────────────────

    CreateReceiptRequest:
      type: object
      required: [location, date, taxAmount]
      properties:
        description:
          type:
            - string
            - "null"
        location:
          type: string
        date:
          type: string
          format: date
        taxAmount:
          type: number
          format: double

    UpdateReceiptRequest:
      type: object
      required: [id, location, date, taxAmount]
      properties:
        id:
          type: string
          format: uuid
        description:
          type:
            - string
            - "null"
        location:
          type: string
        date:
          type: string
          format: date
        taxAmount:
          type: number
          format: double

    ReceiptResponse:
      type: object
      required: [id, location, date, taxAmount]
      properties:
        id:
          type: string
          format: uuid
        description:
          type:
            - string
            - "null"
        location:
          type: string
        date:
          type: string
          format: date
        taxAmount:
          type: number
          format: double

    # ── Receipt Item ─────────────────────────────

    CreateReceiptItemRequest:
      type: object
      required: [receiptItemCode, description, quantity, unitPrice, category, subcategory]
      properties:
        receiptItemCode:
          type: string
        description:
          type: string
        quantity:
          type: number
          format: double
        unitPrice:
          type: number
          format: double
        category:
          type: string
        subcategory:
          type: string

    UpdateReceiptItemRequest:
      type: object
      required: [id, receiptItemCode, description, quantity, unitPrice, category, subcategory]
      properties:
        id:
          type: string
          format: uuid
        receiptItemCode:
          type: string
        description:
          type: string
        quantity:
          type: number
          format: double
        unitPrice:
          type: number
          format: double
        category:
          type: string
        subcategory:
          type: string

    ReceiptItemResponse:
      type: object
      required: [id, receiptItemCode, description, quantity, unitPrice, category, subcategory]
      properties:
        id:
          type: string
          format: uuid
        receiptItemCode:
          type: string
        description:
          type: string
        quantity:
          type: number
          format: double
        unitPrice:
          type: number
          format: double
        category:
          type: string
        subcategory:
          type: string

    # ── Transaction ──────────────────────────────

    CreateTransactionRequest:
      type: object
      required: [amount, date]
      properties:
        amount:
          type: number
          format: double
        date:
          type: string
          format: date

    UpdateTransactionRequest:
      type: object
      required: [id, amount, date]
      properties:
        id:
          type: string
          format: uuid
        amount:
          type: number
          format: double
        date:
          type: string
          format: date

    TransactionResponse:
      type: object
      required: [id, amount, date]
      properties:
        id:
          type: string
          format: uuid
        amount:
          type: number
          format: double
        date:
          type: string
          format: date

    # ── Aggregates (read-only) ───────────────────

    ReceiptWithItemsResponse:
      type: object
      required: [receipt, items]
      properties:
        receipt:
          $ref: "#/components/schemas/ReceiptResponse"
        items:
          type: array
          items:
            $ref: "#/components/schemas/ReceiptItemResponse"

    TransactionAccountResponse:
      type: object
      required: [transaction, account]
      properties:
        transaction:
          $ref: "#/components/schemas/TransactionResponse"
        account:
          $ref: "#/components/schemas/AccountResponse"

    TripResponse:
      type: object
      required: [receipt, transactions]
      properties:
        receipt:
          $ref: "#/components/schemas/ReceiptWithItemsResponse"
        transactions:
          type: array
          items:
            $ref: "#/components/schemas/TransactionAccountResponse"

    ProblemDetails:
      type: object
      properties:
        type:
          type:
            - string
            - "null"
        title:
          type:
            - string
            - "null"
        status:
          type:
            - integer
            - "null"
          format: int32
        detail:
          type:
            - string
            - "null"
        instance:
          type:
            - string
            - "null"
